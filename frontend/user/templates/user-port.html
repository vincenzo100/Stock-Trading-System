<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>KVB Stocks - My Portfolio</title>
        <link rel="stylesheet" href="/static/user-port-layout.css">
        <link rel="stylesheet" href="/static/user-port-styles.css">
        <link rel="stylesheet" href="/static/nav-bar.css">
    </head>
    <header>
        <table class="logo">
            <td><a class="logo" href="/user-dash.html">KVB Stocks</a></td>
        </table>
        <table class="nav">
            <td><a href="/user-trans.html">Transactions</a></td>
            <td><a href="/user-port.html">Portfolio</a></td>
            <td><a href="/user-login.html">Log Out</a></td>
        </table>
        <table class="line">
            <tr></tr>
        </table>
    </header>
    <!--always copy above text for nav bar-->
    <body>
        <table class="title">
            <td>My Portfolio</td>
        </table>
        <div class="bod">
            <div class="header">
                <p>
                    Total Portfolio Value
                </p>
                <p>$ 00.00</p>
                <!--insert function that calculates total port value to display-->
            </div>
            <table class="total">
                <tr>
                    <td class="item">Stocks</td>
                    <td class="data">notes</td><!--insert function that shows total stocks-->
                </tr>
                <tr>
                    <td class="item">Cash</td>
                    <td class="data">notes</td><!--insert function that shows cash-->
                </tr>
            </table>
            <div class="header2">
                <p>
                    Stocks
                </p>
            </div>
            <table class="stocks">
                <tr>
                    <td class="item">Name</td>
                    <td class="item">Ticker</td>
                    <td class="item">Shares</td>
                    <td class="item">Price</td>
                    <td class="item">Return</td>
                    <td class="item">Equity</td>
                </tr>
				<!--need to add something that actually displays the portfolio schtuff!-->
                <tr>
                    <td class="data">notes</td>
                    <td class="data">notes</td>
                    <td class="data">notes</td>
                    <td class="data">notes</td>
                    <td class="data">notes</td>
                    <td class="data">notes</td>
            </table>
        </div>
    </body>
    <script>
        const API_BASE_URL = "https://stock-trading-system-production.up.railway.app/api/";  // Backend API URL

        document.addEventListener("DOMContentLoaded", function() {
            fetch(`${API_BASE_URL}portfolio/`)  // Uses base URL dynamically
                .then(response => response.json())
                .then(data => {
                    let portfolioList = "";
                    if (data.length === 0) {
                        document.getElementById("no-stocks").style.display = "block"; // Show message if empty
                    } else {
                        data.forEach(stock => {
                            let totalValue = stock.quantity * stock.current_price;
                            portfolioList += `<tr>
                                <td>${stock.ticker}</td>
                                <td>${stock.quantity}</td>
                                <td>$${stock.current_price.toFixed(2)}</td>
                                <td>$${totalValue.toFixed(2)}</td>
                            </tr>`;
                        });
                        document.getElementById("portfolio-list").innerHTML = portfolioList;
                    }
                })
                .catch(error => console.error("Error fetching portfolio:", error));
        });
    </script>
</html>
