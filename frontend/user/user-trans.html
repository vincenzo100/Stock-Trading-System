<html>
    <head>
        <meta charset="utf-8">
        <title>KVB Stocks - Transactions</title>
        <link rel="stylesheet" href="user-trans-layout.css">
        <link rel="stylesheet" href="user-trans-styles.css">
        <script defer src="user-trans.js"></script> <!-- Linked to JavaScript for API calls -->
    </head>
    <header>
        <table class="logo">
            <td><a class="logo" href="/user-dash.html">KVB Stocks</a></td> <!-- Fixed path -->
        </table>
        <table class="nav">
            <td><a href="/user-port.html">Portfolio</a></td> <!-- Fixed path -->
            <td><a href="/user-login.html">Log Out</a></td> <!-- Fixed path -->
        </table>
    </header>
    <body>
        <div class="container">
            <h2>Transaction History</h2>
            <table>
                <tr><th>Stock</th><th>Action</th><th>Quantity</th><th>Price</th><th>Date</th></tr>
                <tbody id="transaction-list"></tbody> <!-- Will be populated by JavaScript -->
            </table>
            <p id="no-transactions" style="display:none;">No transactions found.</p> <!-- Message if no transactions -->
        </div>
    </body>
    <script>
        const API_BASE_URL = "https://stock-trading-system-production.up.railway.app/api/";  // Backend API URL

        document.addEventListener("DOMContentLoaded", function() {
            fetch(`${API_BASE_URL}transactions/`)  // Uses base URL dynamically
                .then(response => response.json())
                .then(data => {
                    let transactionList = "";
                    if (data.length === 0) {
                        document.getElementById("no-transactions").style.display = "block"; // Show message if empty
                    } else {
                        data.forEach(transaction => {
                            transactionList += `<tr>
                                <td>${transaction.ticker}</td>
                                <td>${transaction.transaction_type}</td>
                                <td>${transaction.quantity}</td>
                                <td>$${transaction.price_at_transaction.toFixed(2)}</td>
                                <td>${new Date(transaction.date).toLocaleDateString()}</td>
                            </tr>`;
                        });
                        document.getElementById("transaction-list").innerHTML = transactionList;
                    }
                })
                .catch(error => console.error("Error fetching transactions:", error));
        });
    </script>
</html>
